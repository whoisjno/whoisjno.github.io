---
title: "Study 1 Main Test Results"
subtitle: "Tweedie GLMM and Post-Hoc Tests"
author: "Jean-Noël George"
date: "`r Sys.Date()`"
output:
  rmdformats::robobook:
    use_bookdown: TRUE
    number_sections: TRUE

---

```{r load-packages, echo=FALSE, include=FALSE}
library("pacman")
p_load(
  "rmdformats", #rmd themes
  "tidyverse", # tidy data
  "car", # Levene's and Bartlett's test of non-normal distributions
  "qqplotr", # QQ plots
  "Hmisc", # export anovas etc
  "devtools", # download packages from github
  "dplyr", # manipulate data
  "purrr", # tidy data (broom)
  "gtsummary", # report regressions
  "finalfit", # visualise regressions
  "ggsignif", # add significance lines to ggplots
  "dlookr", # describe data
  "ppsr", # predictive power scores
  "flextable", # export to tidy tables
  "sjPlot", # plot regressions
  "report", # report results
  "benelib", #theme_gtsummary_apa
  "easystats", # includes report(), correlations, etc.
  "jtools", # get summ() to summarise and plot regressions
  "performance", # check all assumptions
  "knitr", # for chunk and kable
  "boot", # bootstrap
  "tictoc", # timing
  "parallel", # parallel processing
  "MASS", # glm.nb
  "lme4", # glmer
  "glmmTMB", # glmmTMB
  "tweedie", # tweedie
  "emmeans", # post-hoc tests
  "kableExtra" # kable tables
)

```

```{r setup, echo=FALSE}
# Set global chunk options
knitr::opts_chunk$set(
  warning = FALSE,
  message = FALSE,
  error = FALSE,
  fig.align = "center",
  fig.width = 10,
  fig.height = 5,
  dpi = 36,
  dev = "png"
)

# set gtsummary theme as APA
benelib::theme_gtsummary_apa(set_theme = TRUE)

# set rg limit for emmeans (default i 1000, which is too low)
emm_options(rg.limit = 92160)


```


```{r load-all-data, echo=FALSE}

setwd("/Users/46079386/Library/CloudStorage/OneDrive-MacquarieUniversity/Academic/PhD/Study-1/Main Test — MTurk/Analysis/S1-MT_GLM")

load("RData/003_glm_data.RData") # df used for models
load("RData/tweedieGLMM/003_simple_tweedie_model.RData") # tweedie simple model
load("RData/tweedieGLMM/003_interaction_tweedie_model.RData") # tweedie interaction model


# factor cols
fac_cols <- c(
  "stimuliType",
  "Gender",
  "childGender",
  "Education",
  "Ethnicity",
  "Religion",
  "Occupation",
  "Diet"
)

for (i in fac_cols) {
  glm_data[[i]] <- as.factor(glm_data[[i]])
}
# level sociodemographics

contrasts(glm_data$Education) <-
  contr.treatment(levels(glm_data$Education),
                  base = which(levels(glm_data$Education) == "HigherEducation")
  )

contrasts(glm_data$Ethnicity) <-
  contr.treatment(levels(glm_data$Ethnicity),
                  base = which(levels(glm_data$Ethnicity) == "nonWhite")
  )

contrasts(glm_data$Religion) <-
  contr.treatment(levels(glm_data$Religion),
                  base = which(levels(glm_data$Religion) == "Christian")
  )

contrasts(glm_data$Occupation) <-
  contr.treatment(levels(glm_data$Occupation),
                  base = which(levels(glm_data$Occupation) == "Administration")
  )


```

------------------------------------------------------------------------

# Hypotheses:

1. Anthropomorphism in the toy products (i.e. anthropomorphic robots) will be rated as having a higher perceived value.
    1. aRobots compared to the control (novel object)
    2. mRobots compared to the control
    3. aRobots compared to mRobots
2. Participants with positive attitudes towards robots will rate stimuli with more anthropomorphism as having a higher perceived value.
    1. aRobots compared to the control (novel object)
    2. mRobots compared to the control
    3. aRobots compared to mRobots
3. Participants with negative attitudes towards robots will rate stimuli with more anthropomorphism as having a lower perceived value.
    1. aRobots compared to the control (novel object)
    2. mRobots compared to the control
    3. aRobots compared to mRobots
4. Participants with an increased tendency to engage in anthropomorphism more than with a reduced tendency will rate both the anthropomorphic and the mechanomorphic robots as having a higher perceived value.
    1. aRobots compared to the control (novel object)
    2. mRobots compared to the control
    3. aRobots compared to mRobots
5.  The effect of anthropomorphic tendency will be particularly evident with people's tendency to engage in anthropomorphism of technological objects.

------------------------------------------------------------------------


How the hypotheses align with main effects, simple effects, and interactions:

## Main Effects
These reflect the general/broader effects of each variable independently:
---
### Anthropomorphism Level (Stimuli Type):
The level of anthropomorphism in toys (stimuli type: aRobot, mRobot, nObject) affects perceptions of value.

### Attitudes Toward Robots:
Sronger attitudes (positive or negative) affect perceptions of value, compared to weaker attitudes.

### Anthropomorphism Tendency:
The tendency to anthropomorphise affects perceptions of value, with those higher in anthropomorphism tendency rating value higher overall.


## Simple Effects
These reflect the specific effects at levels of the independent variables, typically broken down further:
---

### Anthropomorphism Level (Stimuli Type):
Perceived value differs by stimuli type in a specific order:
aRobot > mRobot > nObject.

### Attitudes Toward Robots (Positive vs. Negative):

#### Positive Attitudes:
Stimuli with higher anthropomorphism are rated as having higher perceived value (aRobot > mRobot > nObject).

#### Negative Attitudes:
Stimuli with higher anthropomorphism are rated as having lower perceived value (aRobot < mRobot < nObject).

### Anthropomorphism Tendency:
Participants with higher anthropomorphism tendency rate value higher.
This effect is more pronounced for technological objects compared to animal or nature-related stimuli.


## Interactions
These reflect how two or more variables combine to influence the outcome:
---

### Interaction Between Stimuli Type and Attitudes Toward Robots:
The relationship between stimuli type (aRobot, mRobot, nObject) and perceived value depends on participants’ attitudes (positive vs. negative).

### Interaction Between Anthropomorphism Tendency and Stimuli Type:
The relationship between anthropomorphism tendency and perceived value is stronger for technological stimuli compared to animal or nature stimuli.

Model Formula:
  pervalRating ~ # perceived value ratings
  stimuliType * gatorsScore + # main effect of stimuli type and interaction with attitudes
  stimuliType * idaqScore +  # main effect of stimuli type and interaction with anthropomorphism tendency
  pervalItem + gatorsScale + idaqScale + # fixed effects of scale items
  Age + Gender + childAge + childGender + # fixed effect of demographics
  Education + Ethnicity + Religion + Occupation + Diet +
  (1 | MID), # controlling for/grouping by participant




Removed diet due to high VIF




------------------------------------------------------------------------

# Tweedie Model

general linear mixed model (tweedie family with a log link) (estimated using ML and nlminb optimizer) to predict pervalRating with stimuliType, gatorsScore, gatorsScale, idaqScore, idaqScale, pervalItem, Age, Gender, childAge, childGender, Education, Ethnicity, Religion and Occupation (formula: pervalRating ~ stimuliType * (gatorsScore * gatorsScale) + stimuliType * (idaqScore * idaqScale) + pervalItem + Age + Gender + childAge + childGender + Education + Ethnicity + Religion + Occupation). The model included MID as random effect (formula: ~1 | MID)>

------------------------------------------------------------------------

```{r interaction-tweedie_model, echo=FALSE, eval=FALSE}

tweedie_terms <- glmmTMB(
  pervalRating ~
  stimuliType + gatorsScore + idaqScore +
  pervalItem + gatorsScale + idaqScale +
  Age + Gender + childAge + childGender +
  Education + Ethnicity + Religion + Occupation + Diet +
  (1 | MID),
  data = glm_data,
  family = tweedie(link = "log"),
  control = glmmTMBControl(optCtrl = list(iter.max=1e3,eval.max=1e3))
)

check_collinearity(tweedie_terms)

# Remove Diet due to high VIF

int_tweedie_model_report <- glmmTMB(
  pervalRating ~
  stimuliType * (gatorsScore * gatorsScale) +
  stimuliType * (idaqScore * idaqScale) +
  pervalItem +
  Age + Gender + childAge + childGender +
  Education + Ethnicity + Religion + Occupation +
  (1 | MID),
  data = glm_data,
  family = tweedie(link = "log"),
  control = glmmTMBControl(optCtrl = list(iter.max=1e3,eval.max=1500))
)

# save(int_tweedie_model, file = "RData/tweedieGLMM/003_interaction_tweedie_model.RData") # tweedie model

int_tweedie_report <- report(int_tweedie_model_report)

model_is_supported <- insight::model_info(int_tweedie_model)
print(model_is_supported)

```

```{r interaction-tweedie_model-summary, echo=FALSE}

tbl_regression(int_tweedie_model, conf.int = TRUE, exponentiate = TRUE) %>%
  bold_p()

int_tweedie_tidy <- int_tweedie_model %>%
  broom::tidy()


int_tweedie_tidy %>%
  report()

performance(int_tweedie_model)

report_statistics(int_tweedie_model)

report::report_performance(int_tweedie_model)

```



## Model Summary {.sub-heading}

```{r interaction-tweedie_model-performance, echo=FALSE}

performance(int_tweedie_model) %>%
  flextable(col_keys = names(.)) %>%
  autofit() %>%
  set_table_properties(
      layout = "autofit",
      opts_html = list(
        scroll = list(
          width = 410
        )
      )
    ) %>%
    flextable::align(align = "center", part = "all") %>%
    flextable::theme_apa()

report_model(int_tweedie_model)
```


```{r interaction-tweedie_model-checks, echo=FALSE}


check_distribution(int_tweedie_model)

check_predictions(int_tweedie_model)

check_residuals(int_tweedie_model)

check_autocorrelation(int_tweedie_model)

check_heteroscedasticity(int_tweedie_model)

tbl_regression(int_tweedie_model, conf.int = TRUE, exponentiate = TRUE) %>%
  gtsummary::bold_labels() %>%
  gtsummary::add_global_p() %>%
  gtsummary::bold_p()

```


## Bootstrapping

```{r load-interaction-tweedie_model-bootstraps, echo=FALSE}

load("RData/tweedieGLMM/sig_interaction_tweedie_merged_bootstrap_results.RData")
load("RData/tweedieGLMM/2000_interaction_tweedie_bootstrap_df_results.RData")
load("RData/tweedieGLMM/003_interaction_tweedie_model.RData") # tweedie model

```

```{r interaction-tweedie_model-bootstrap_funtion, echo=FALSE, eval=FALSE}
tweedie_glmmtmb_boot <- function(data, indices) {

  # Resample the data
  boot_data <- data[indices, ]

  # Fit the model
  model <- glmmTMB::glmmTMB(
      pervalRating ~
      stimuliType * (gatorsScore * gatorsScale) +
      stimuliType * (idaqScore * idaqScale) +
      pervalItem +
      Age + Gender + childAge + childGender +
      Education + Ethnicity + Religion + Occupation +
      (1 | MID),
    data = boot_data,
    family = glmmTMB::tweedie(link = "log"),
    control = glmmTMB::glmmTMBControl(optCtrl = list(
      iter.max = 1e3, eval.max = 1500
    ))
  )

  # Extract fixed-effect coefficients
  return(as.numeric(glmmTMB::fixef(model)$cond))


}

set.seed(123)  # Set seed for reproducibility
library(tictoc)

print(Sys.time())
tic()
# Perform bootstrapping
int_tweedie_glmmtmb_boot_results <- boot::boot(
  data = glm_data,  # Replace with your actual data frame
  statistic = tweedie_glmmtmb_boot,
  R = 2000,  # Number of bootstrap iterations
  parallel = "multicore",  # Use multicore processing
  ncpus = 7  # Number of cores to use (adjust based on your system)
)
toc()
print(Sys.time())

# 15.6 hour runtime (56287.445 secs)
```

```{r tidy-interaction-tweedie_model-boot, echo=FALSE, eval=FALSE}
# Extract the fixed effects from the original model
int_fixed_tweedie_effects <- fixef(int_tweedie_model)$cond  # Extract conditional fixed effects

# Extract bootstrap results from the bootMer object
int_tweedie_bootstrap_results <- int_tweedie_glmmtmb_boot_results$t

# Ensure column names of bootstrap results match fixed effects
colnames(int_tweedie_bootstrap_results) <- names(int_fixed_tweedie_effects)

# calculate confidence intervals and p-values
conf_intervals <- apply(int_tweedie_bootstrap_results, 2, quantile, probs = c(0.025, 0.975))

p_values <- apply(int_tweedie_bootstrap_results, 2, function(boot_samples) {
  mean(abs(boot_samples) >= abs(int_fixed_tweedie_effects))  # Two-tailed p-value
})

# Create a tibble with labels, fixed effects, bias, and std_error
int_tweedie_bootstrap_df <- tibble(
  label = names(int_fixed_tweedie_effects),  # Fixed effect names from the model
  original = int_fixed_tweedie_effects,  # Coefficients from the model
  bias = colMeans(int_tweedie_bootstrap_results) - int_fixed_tweedie_effects,  # Bias: mean of bootstrap - original fixed effects
  std_error = apply(int_tweedie_bootstrap_results, 2, sd),  # Standard error: standard deviation of bootstrap samples
  conf_low = conf_intervals[1, ],  # Lower bound of 95% CI
  conf_high = conf_intervals[2, ],  # Upper bound of 95% CI
  p_value = p_values  # Two-tailed p-values
)


print(int_tweedie_bootstrap_df, n = 69) # 2000 iterations


```

```{r gtsummary-interaction-tweedie_model-boot, echo=FALSE}

# round original to 2 dec. places and show 2 dec. places to match gtsummary
int_tweedie_bootstrap_gts <- int_tweedie_bootstrap_df %>%
  mutate(original = format(round(original, 2), nsmall = 2)) %>%
  mutate(original = as.numeric(original))


# define a function to convert to scientific notation if < 3 decimal places
to_scientific_notation <- function(x) {
  ifelse(abs(x) < 0.001, sprintf("%.2e", x), sprintf("%.3f", x))
}


int_tweedie_bootstrap_gts %>%
  mutate_if(is.numeric, to_scientific_notation) %>%
  flextable() %>%
  autofit() %>%
  set_table_properties(
      layout = "autofit",
      opts_html = list(
        scroll = list(
          width = 410
        )
      )
    ) %>%
    flextable::align(align = "center", part = "all") %>%
    flextable::theme_apa() %>%
    save_as_html(path = "Results/GLMM and Bootstraps/MTURK Tweedie Model Bootstrap.html")

# save(int_tweedie_glmmtmb_boot_results, int_tweedie_bootstrap_df, int_tweedie_bootstrap_gts, file = "RData/2000_interaction_tweedie_bootstrap_df_results.RData")


```

## Significant Model Coefficients with Bootstrap Results
```{r interaction-tweedie_model-regression_boot_comparison, echo=FALSE}

library(stringr)

# Create a table from the regression output
int_model_results <- tbl_regression(int_tweedie_model, conf.int = TRUE)

# Convert the model results to a tibble and filter for significant p-values
int_model_results_tibble <- as_tibble(int_model_results)


# Filter the results to keep only rows with p-value < 0.05
int_significant_results <- int_model_results_tibble %>%
  filter(`**p-value**` < 0.05) %>% # Keep only significant results (p < 0.05)
  filter(`**p-value**` != ">0.9") %>%
  filter(`**p-value**` == "<0.001")


# rename columns
colnames(int_significant_results) <- c("label", "estimate", "conf.int", "p_value")

int_significant_results <- as_tibble(int_significant_results)

# round bootstrap results to 2 dec. places
# round original to 2 dec. places and show 2 dec. places to match gtsummary
int_bootstrap_results <- int_tweedie_bootstrap_df %>%
  mutate(original = as.numeric(round(original, 2)))

int_merged_results <- int_significant_results %>%
  rowwise() %>%
  mutate(
    bootstrap_match = list(
      int_bootstrap_results %>%
        filter(str_detect(int_bootstrap_results$label, label) &
               as.numeric(estimate) == original) %>%
        rename(bootstrap_label = label)  # Rename the 'label' column
    )
  ) %>%
  unnest(cols = c(bootstrap_match))


int_significant_merged_results <- int_merged_results %>%
  distinct(label, .keep_all = TRUE)  # Keep only unique rows for each label

# scientific notation formula
# define a function to convert to scientific notation if < 3 decimal places
to_scientific_notation <- function(x) {
  ifelse(abs(x) < 0.001, sprintf("%.2e", x), sprintf("%.3f", x))
}


# select columns of interest

int_boot_reg_results <- int_significant_merged_results %>%
  dplyr::select(label, "estimate", conf.int, p_value, bias, std_error) %>%
  rename(
    variable = label,
    bootstrap_bias = bias,
    bootstrap_std_error = std_error) %>%
  mutate_if(is.numeric, to_scientific_notation) %>%
  mutate(percent_change = ifelse(
    !is.na(as.numeric(estimate)), (exp(as.numeric(estimate)) - 1) * 100, NA
  )) %>%
  mutate(percent_change = round(percent_change, 2)) %>%
  dplyr::select(variable, estimate, percent_change, conf.int, p_value, bootstrap_bias, bootstrap_std_error)

# flextable
int_boot_reg_results %>%
  flextable() %>%
  autofit() %>%
  set_table_properties(
      layout = "autofit",
      opts_html = list(
        scroll = list(
          width = 410
        )
      )
    ) %>%
    flextable::align(align = "center", part = "all") %>%
    flextable::theme_apa()

#save(int_boot_reg_results, file = "RData/tweedieGLMM/sig_interaction_tweedie_merged_bootstrap_results.RData")

```

Bootstrap results show there is a low bias and low standard error for all significant results, suggesting that model is robust to sampling variance.

## Hypotheses Results

### Main Effects
#### Anthropomorphism Level (Stimuli Type) = Supported
The level of anthropomorphism in toys (stimuli type: aRobot, mRobot, nObject) affects perceptions of value.

#### Attitudes Toward Robots =Supported
Sronger attitudes (positive or negative) affect perceptions of value, compared to weaker attitudes.

#### Anthropomorphism Tendency = Supported
The tendency to anthropomorphise affects perceptions of value, with those higher in anthropomorphism tendency rating value higher overall.


------------------------------------------------------------------------

Model Summary: Tweedie GLM with glmmTMB
The analysis was conducted using a Tweedie GLM to assess how different variables influence the pervalRating. Here are the key results:

Fixed Effects (Coefficients):
Stimuli Type:
The stimuli type, particularly aRobot (2.58, p < 0.001) and mRobot (2.01, p < 0.001), had significant positive effects on redicted pervalRating, with both having strong positive effects compared to the baseline category (nObject).
GatorsScore and idaqScore:
Both gatorsScore (estimate = 1.1, p < 0.001) and idaqScore (estimate = 1.02, p < 0.001) had significant positive associations with the outcome.
gatorsScale
personalNegative (1.92, p < 0.001), socialPositive (1.71, p < 0.001), and personalPositive (1.36, p < 0.001) were all significant predictors of pervalRating with positive associations compared to the baseline category (socialNegative).
idaqScale
Only the animal subscale (1.14, p < 0.001) was a significant predictor of pervalRating with a positive association compared to overall idaq score. Nature (1.01, p =0.5), techNature (1, 0.8), and technology (1, 0.9) were not significant predictors compared to overall idaq score.
PervalItem:
The subscales of pervalItem (emotion, price, and social) were all significant predictors of pervalRating with positive associations compared to quality (avg estimate approx. 0.99, p < 0.001).

Control Variables (e.g., Age, Gender, and Occupation):
The variables Age (estimate = 1, p = 0.13) and Gender (estimate = 0.008, p = 0.872) were not statistically significant, suggesting no clear relationship with pervalRating in this model.
However, nonReligious (estimate= 0.71, p = <0.001) participants significantly rated the products as having more value compared to Christian participants. Similarly, participants who worked in Sales and Marketing significantly rated  and the products as having less value (estimate = -0.43, p < 0.001) than those working in Adminstration.

Interaction Effects:
StimuliType: gatorsScore * gatorsScale and StimuliType: idaqScore * idaqScale interactions were highly significant, with very small p-values (< 2.2e-16), indicating that the impact of gatorsScore and idaqScore on pervalRating depends on the type of stimuli (aRobot vs mRobot vs nObject).
Model Fit:
The model fit statistics indicate a reasonable fit:
Log-likelihood = -119494
AIC = 239062
BIC = 239419
These values suggest that the model captures the data well, though they also provide room for potential improvements or refinements.
Analysis of Deviance (Chi-squared Tests):
The Analysis of Deviance table, which presents Type II Wald chi-squared tests, reveals:
StimuliType had a significant effect on pervalRating (Chisq = 8432.36, p < 2.2e-16).
PervalItem (Chisq = 67.77, p < 1.28e-14) also had a highly significant influence on pervalRating.
Other terms like GatorsScore, idaqScore, Religion, and Occupation showed varied significance across the model, with notable interaction terms (StimuliType: gatorsScore and StimuliType: idaqScore) indicating strong interdependencies between the predictors.
Model Residuals:
The residual degrees of freedom were 115723, consistent with the large sample size (n = 115760).
The residuals' distribution was examined, and the model performed well in explaining the variability in pervalRating.
Conclusion:
The Tweedie GLM revealed that stimuliType, gatorsScore, idaqScore, and the subscales of pervalItem significantly influenced pervalRating, with significant interaction effects. Notably, variables like Age and Gender did not contribute significantly to the model, while Religion and Occupation had moderate effects. The analysis of deviance confirmed that the fixed effects, particularly those involving stimuliType and its interactions with gatorsScore and idaqScore, were pivotal in explaining the observed ratings.

------------------------------------------------------------------------

# Residuals

------------------------------------------------------------------------


```{r residuals, echo=FALSE}

# Install and load DHARMa
library(DHARMa)

# Simulate residuals from your fitted model
simulated_residuals <- simulateResiduals(int_tweedie_model)

# Plot DHARMa residuals
plot(int_tweedie_model)


```

------------------------------------------------------------------------

# Post-Hoc Tests {.tabset .heading}

------------------------------------------------------------------------

## Main Effects {.tabset .tabset-fade .sub-heading}

### Main Effect 1: Stimuli Type {.sub-sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r main_1-emmeans, echo=FALSE, class.output="results"}



main_1 <- emmeans(int_tweedie_model, pairwise ~ stimuliType)

# Extract estimated means
main_1.emmeans_tbl <- main_1 %>%
  summary(adjust = "sidak") %>%
  .$emmeans%>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3))

# Extract pairwise contrasts
main_1.contrasts_tbl <- main_1 %>%
  summary(adjust = "sidak") %>%
  .$contrasts %>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3)) %>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .))%>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .)) %>%
  mutate(signif = case_when(
    p.value < 0.001 ~ "***",
    p.value < 0.01 ~ "**",
    p.value < 0.05 ~ "*",
    TRUE ~ ""
  ))

# Create separate tables
main_1.emmeans_table <- main_1.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

main_1.contrasts_table <- main_1.contrasts_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_1.emmeans_table
main_1.contrasts_table

```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_1-plot, echo=FALSE, class.output="results"}

# Plot emmeans result

main_1.p <- emmip(
  int_tweedie_model, ~ stimuliType,
  type = "response", mode = "prob",
  CIs = TRUE, infer = TRUE,
  adjust = "tukey", plotit = FALSE) %>%
  as.data.frame()

ggplot(main_1.p, aes(
  x = stimuliType, y = yvar, color = stimuliType, fill = stimuliType
)) +
  geom_line(aes(), group = "stimuliType", linewidth = 1, color = "black") +
  geom_point(aes(fill = stimuliType), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = stimuliType),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Probability of Perveived Value Ratings by Stimuli Type"
  ) +
  xlab("Stimuli Type") +
  ylab("Predicted Probability") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )




```

#### Results Summary {.sub-sub-heading}


### Main Effect 2: Perval Item {.sub-sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r main_2-emmeans, echo=FALSE}

main_2 <- emmeans(simple_tweedie_model, pairwise ~ pervalItem)

# Extract estimated means
main_2.emmeans_tbl <- main_2 %>%
  summary(adjust = "sidak") %>%
  .$emmeans%>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3))

# Extract pairwise contrasts
main_2.contrasts_tbl <- main_2 %>%
  summary(adjust = "sidak") %>%
  .$contrasts %>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3)) %>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .))%>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .)) %>%
  mutate(signif = case_when(
    p.value < 0.001 ~ "***",
    p.value < 0.01 ~ "**",
    p.value < 0.05 ~ "*",
    TRUE ~ ""
  ))

# Create separate tables
main_2.emmeans_table <- main_2.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

main_2.contrasts_table <- main_2.contrasts_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_2.emmeans_table
main_2.contrasts_table

```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_2-plot, echo=FALSE}


main_2.p <- emmip(
  simple_tweedie_model, ~ pervalItem,
  type = "response", mode = "prob",
  CIs = TRUE, infer = TRUE,
  adjust = "tukey", plotit = FALSE) %>%
  as.data.frame()

ggplot(main_2.p, aes(
  x = pervalItem, y = yvar, color = pervalItem, fill = pervalItem
)) +
  geom_line(aes(), group = "pervalItem", linewidth = 1, color = "black") +
  geom_point(aes(fill = pervalItem), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = pervalItem),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Perveived Value Ratings by PERVAL Item"
  ) +
  xlab("Stimuli Type") +
  ylab("Predicted Value") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )

```

#### Results Summary {.sub-sub-heading}


### Main Effect 3: GAToRS Score {.sub-sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r main_3-emmeans, echo=FALSE}
main_3 <- emmeans(
  simple_tweedie_model, ~ gatorsScore,
  at = list(gatorsScore = seq(1, 5.0, by = 0.5)), #summary(glm_data$gatorsScore)
  rg.limit = 829440
  )

# Extract estimated means
main_3.emmeans_tbl <- main_3 %>%
  summary(adjust = "sidak") %>%
  .$emmeans

# Create separate tables
main_3.emmeans_table <- main_3.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_3.emmeans_table
```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_3-plot, echo=FALSE}

main_3.p <- emmip(
  simple_tweedie_model, ~ gatorsScore,
  mode = "prob",
  type = "log",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE,
  at = list(gatorsScore = seq(1, 5.0, by = 0.5)), #summary(glm_data$gatorsScore)
  rg.limit = 829440
 ) %>%
  as.data.frame()

ggplot(main_3.p, aes(
  x = gatorsScore, y = yvar, color = gatorsScore, fill = gatorsScore
)) +
  geom_line(aes(), group = "gatorsScore", linewidth = 1, color = "black") +
  geom_point(aes(fill = gatorsScore), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = gatorsScore),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Perveived Value Ratings by GAToRS Score"
  ) +
  xlab("GAToRS Score") +
  ylab("Predicted Value") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )

```

#### Results Summary {.sub-sub-heading}



### Main Effect 4: IDAQ Score {.sub-sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r main_4-emmeans, echo=FALSE}

main_4 <- emmeans(
  simple_tweedie_model, ~ idaqScore,
  at = list(idaqScore = seq(0, 9.8, by = 0.98)), #summary(glm_data$idaqScore)
  rg.limit = 1013760
  )

# Extract estimated means
main_4.emmeans_tbl <- main_4 %>%
  summary(adjust = "sidak") %>%
  .$emmeans

# Create separate tables
main_4.emmeans_table <- main_4.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_3.emmeans_table

```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_4-plot, echo=FALSE}
main_4.p <- emmip(
  simple_tweedie_model, ~ idaqScore,
  mode = "prob",
  type = "log",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE,
  at = list(idaqScore = seq(0, 9.8, by = 0.98)), #summary(glm_data$idaqScore)
  rg.limit = 1013760
 ) %>%
  as.data.frame()

ggplot(main_4.p, aes(
  x = idaqScore, y = yvar, color = idaqScore, fill = idaqScore
)) +
  geom_line(aes(), group = "idaqScore", linewidth = 1, color = "black") +
  geom_point(aes(fill = idaqScore), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = idaqScore),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Perveived Value Ratings by IDAQ Score"
  ) +
  xlab("IDAQ Score") +
  ylab("Predicted Value") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )


```

#### Results Summary {.sub-sub-heading}



### Main Effect 5: Religion {.sub-sub-heading}

```{r main_5-emmeans, echo=FALSE}

main_5 <- emmeans(simple_tweedie_model, pairwise ~ Religion)

# Extract estimated means
main_5.emmeans_tbl <- main_5 %>%
  summary(adjust = "sidak") %>%
  .$emmeans%>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3))

# Extract pairwise contrasts
main_5.contrasts_tbl <- main_5 %>%
  summary(adjust = "sidak") %>%
  .$contrasts %>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3)) %>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .))%>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .)) %>%
  mutate(signif = case_when(
    p.value < 0.001 ~ "***",
    p.value < 0.01 ~ "**",
    p.value < 0.05 ~ "*",
    TRUE ~ ""
  ))

# Create separate tables
main_5.emmeans_table <- main_5.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

main_5.contrasts_table <- main_5.contrasts_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_5.emmeans_table
main_5.contrasts_table



```
#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_5-plot, echo=FALSE}

main_5.p <- emmip(
  simple_tweedie_model, ~ Religion,
  type = "response", mode = "prob",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE) %>%
  as.data.frame()

ggplot(main_5.p, aes(
  x = Religion, y = yvar, color = Religion, fill = Religion
)) +
  geom_line(aes(), group = "Religion", linewidth = 1, color = "black") +
  geom_point(aes(fill = Religion), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = Religion),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Perveived Value Ratings by Religion Category"
  ) +
  xlab("Religion Category") +
  ylab("Predicted Probability") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )





```

#### Results Summary {.sub-sub-heading}


### Main Effect 6: Occupation {.sub-heading}


```{r main_6-emmeans, echo=FALSE}
# Continuous x Categorial = emtrends
main_6 <- emmeans(simple_tweedie_model, pairwise ~ Occupation)

# Extract estimated means
main_6.emmeans_tbl <- main_6 %>%
  summary(adjust = "sidak") %>%
  .$emmeans%>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3))

# Extract pairwise contrasts
main_6.contrasts_tbl <- main_6 %>%
  summary(adjust = "sidak") %>%
  .$contrasts %>%
  as.data.frame() %>%
  mutate_if(is.numeric, function(x) round(x, 3)) %>%
  mutate_at("p.value", ~ifelse(. < 0.001, "< 0.001", .)) %>%
  mutate(signif = case_when(
    p.value < 0.001 ~ "***",
    p.value < 0.01 ~ "**",
    p.value < 0.05 ~ "*",
    TRUE ~ ""
  ))

# Create separate tables
main_6.emmeans_table <- main_6.emmeans_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

main_6.contrasts_table <- main_6.contrasts_tbl %>%
  kable() %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
main_6.emmeans_table
main_6.contrasts_table


```
#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r main_6-plot, echo=FALSE}

main_6.p <- emmip(
  simple_tweedie_model, ~ Occupation,
  type = "response", mode = "prob",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE) %>%
  as.data.frame()

ggplot(main_6.p, aes(
  x = Occupation, y = yvar, color = Occupation, fill = Occupation
)) +
  geom_line(aes(), group = "Occupation", linewidth = 1, color = "black") +
  geom_point(aes(fill = Occupation), size = 8, colour = "black", pch = 21) +
  geom_pointrange(aes(ymin = LCL, ymax = UCL, color = Occupation),
  linewidth = 5, alpha = 0.3) +
  ggtitle(
    "Predicted Value Ratings by Occupation Category"
  ) +
  xlab("Occupation Category") +
  ylab("Predicted Probability") +
  theme_bw() +
  theme(
    legend.position = "none",
    plot.title = element_text(hjust = rel(0.3)),
    plot.title.position = "plot"
  )

```

#### Results Summary {.sub-sub-heading}


## Interaction Effects {.tabset .tabset-fade .heading}

### Interaction 1: Robot Type x GAToRS Score {.sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r int_1-emtrends, echo=FALSE}
# Continuous x Categorial = emtrends

int_1 <- emtrends(
  simple_tweedie_model,  "stimuliType", var = "gatorsScore"
)

int_1 %>%
  summary(adjust = "sidak") %>%
  as.data.frame()

# Create separate tables
int_1.emmeans_table <- int_1 %>%
  kable(digits = 3) %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
int_1.emmeans_table

```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r int_1-plot, echo=FALSE}

int_1.p <- emmip(
  simple_tweedie_model, stimuliType ~ gatorsScore,
  mode = "prob",
  type = "log",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE,
  at = list(gatorsScore = seq(1, 5.0, by = 0.5)), #summary(glm_data$gatorsScore)
  rg.limit = 829440
 ) %>%
  as.data.frame()

ggplot(int_1.p, aes(
  x = gatorsScore, y = yvar, color = stimuliType, fill = stimuliType
)) +
  geom_line(linewidth = 1) +
  geom_point(size = 3, shape = 21, color = "black") +
  geom_pointrange(
    aes(ymin = LCL, ymax = UCL),
    linewidth = 0.5, alpha = 0.3
  ) +
  ggtitle("Predicted Perceived Value Ratings by GAToRS Score") +
  xlab("GAToRS Score") +
  ylab("Predicted Value") +
  theme_bw() +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5),
    plot.title.position = "plot"
  )


```

#### Results Summary {.sub-sub-heading}


### Interaction 2: Stimuli Type x IDAQ Score {.sub-sub-heading}

#### Estimated Marginal Means {.sub-sub-heading}

```{r int_2-emtrends, echo=FALSE}
int_2 <- emtrends(
  simple_tweedie_model,  "stimuliType", var = "idaqScore"
)

int_2 %>%
  summary(adjust = "sidak") %>%
  as.data.frame()

# Create separate tables
int_2.emmeans_table <- int_2 %>%
  kable(digits = 3) %>%
  kable_styling(full_width = FALSE, position = "center")

# Display each table (or combine)
int_2.emmeans_table

```

#### Estimated Marginal Means Plot {.sub-sub-heading}

```{r int_2-plot, echo=FALSE}
int_2.p <- emmip(
  simple_tweedie_model, stimuliType ~ idaqScore,
  mode = "prob",
  type = "log",
  CIs = TRUE, infer = TRUE,
  adjust = "sidak", plotit = FALSE,
  at = list(idaqScore = seq(0, 9.8, by = 0.98)), #summary(glm_data$idaqScore)
  rg.limit = 1013760
 ) %>%
  as.data.frame()

ggplot(int_2.p, aes(
  x = idaqScore, y = yvar, color = stimuliType, fill = stimuliType
)) +
  geom_line(linewidth = 1) +
  geom_point(size = 3, shape = 21, color = "black") +
  geom_pointrange(
    aes(ymin = LCL, ymax = UCL),
    linewidth = 0.5, alpha = 0.3
  ) +
  ggtitle("Predicted Perceived Value Ratings by IDAQ Score") +
  xlab("IDAQ Score") +
  ylab("Predicted Value") +
  theme_bw() +
  theme(
    legend.position = "right",
    plot.title = element_text(hjust = 0.5),
    plot.title.position = "plot"
  )

```

#### Results Summary {.sub-sub-heading}

------------------------------------------------------------------------

## All Post-Hoc Rest Results

```{r all-emmeans, echo=FALSE}

main_1
main_2
main_3
main_4
main_5
main_6
int_1
int_2

```


## Reporting Statistics
```{r all-emmeans, echo=FALSE}

aov_results <- car::Anova(simple_tweedie_model, type = "II", test = "F")
chisq_value <- aov_results[["Chisq"]]
df1 <- aov_results[["Df"]]
p_value <- aov_results[["Pr(>Chisq)"]]

coef(summary(simple_tweedie_model))


tidy(simple_tweedie_model) %>%
  print(n = 35)

glance(simple_tweedie_model)

aov_results

```

Main Effects:A significant main effect of stimuliType on perceived value ratings was observed,F(df1,df2)=X,p<.001F(df1,df2)=X,p<.001. Post-hoc comparisons using Tukey adjustments revealed that aRobot (M=1.96M=1.96, SE = 0.079) was rated significantly higher than both mRobot (M=1.90M=1.90, SE = 0.079,p<.0001p<.0001) and nObject (M=1.76M=1.76, SE = 0.079,p<.0001p<.0001). Similarly, mRobot was rated significantly higher than nObject (p<.0001p<.0001).For perceived value across pervalItem, although mean scores were similar across categories, significant pairwise differences were found (e.g., emotion was rated higher than quality,p=.0004p=.0004).Interaction Effects:A significant interaction was observed between stimuliType and GAToRS score (F(df1,df2)=X,p<.001F(df1,df2)=X,p<.001). Simple slopes analyses indicated that GAToRS score was negatively associated with perceived value for aRobot (B=−0.021B=−0.021, SE = 0.002,p<.05p<.05) and mRobot (B=−0.009B=−0.009, SE = 0.002,p<.05p<.05), whereas the association was positive for nObject (B=0.038B=0.038, SE = 0.003,p<.05p<.05).Additional Factors:Religion was significantly associated with perceived value ratings (F(df1,df2)=X,p=.002F(df1,df2)=X,p=.002), with non-religious participants reporting lower perceived value than Christians (p=.002p=.002) but not differing significantly from non-Christians (p=.238p=.238).Note:In all cases, results are reported on the log-transformed scale. Confidence intervals are presented at the 95% level.